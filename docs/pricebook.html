<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORION Price Book Pro | Interactive Pricing System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --primary-dark: #1e40af;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #ffffff;
            --bg-light: #f1f5f9;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.15);
            --radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        /* ===== HEADER ===== */
        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: white;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-light), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.3rem;
        }

        .logo-text span {
            color: var(--accent);
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 10px;
            transition: var(--transition);
        }

        .nav-tab:hover,
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-tab.active {
            background: var(--primary-light);
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ===== CALCULATOR SECTION ===== */
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .calc-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .calc-card h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .result-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .result-card h2 {
            color: white;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            opacity: 0.9;
        }

        .result-value {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .result-total {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
        }

        .result-total .label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .result-total .amount {
            font-size: 3rem;
            font-weight: 900;
        }

        .margin-badge {
            display: inline-block;
            background: var(--success);
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        /* ===== PACKAGES SECTION ===== */
        .packages-header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .packages-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .packages-header p {
            opacity: 0.8;
        }

        .service-selector {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .service-selector label {
            font-weight: 600;
            margin-right: 1rem;
        }

        .service-selector select {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            min-width: 300px;
        }

        .packages-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .package-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .package-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-hover);
        }

        .package-card.recommended {
            border: 3px solid var(--accent);
        }

        .package-card.recommended::before {
            content: '‚≠ê RECOMENDADO';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: var(--accent);
            color: var(--bg-dark);
            text-align: center;
            padding: 0.5rem;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .package-header {
            padding: 2rem;
            text-align: center;
        }

        .package-card.recommended .package-header {
            padding-top: 3rem;
        }

        .package-tier {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .package-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .package-price {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--text-dark);
            margin: 1rem 0;
        }

        .package-price span {
            font-size: 1rem;
            font-weight: 400;
            color: var(--text-light);
        }

        .package-features {
            padding: 0 2rem 2rem;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .feature-item:last-child {
            border-bottom: none;
        }

        .feature-check {
            color: var(--success);
            font-weight: bold;
        }

        .package-cta {
            padding: 1.5rem 2rem;
            background: #f8fafc;
        }

        .package-btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .package-card:first-child .package-btn {
            background: #e2e8f0;
            color: var(--text-dark);
        }

        .package-card.recommended .package-btn {
            background: var(--accent);
            color: var(--bg-dark);
        }

        .package-card:last-child .package-btn {
            background: var(--primary);
            color: white;
        }

        .package-btn:hover {
            transform: scale(1.02);
        }

        /* ===== SERVICES CATALOG ===== */
        .search-filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .search-box {
            flex: 1;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
        }

        .filter-btn {
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }

        .services-grid {
            display: grid;
            gap: 1rem;
        }

        .service-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .service-card:hover {
            box-shadow: var(--shadow-hover);
        }

        .service-header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-left: 4px solid var(--primary);
        }

        .service-header:hover {
            background: #f8fafc;
        }

        .service-info h3 {
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .service-info .code {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .service-price-range {
            text-align: right;
        }

        .service-price-range .price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success);
        }

        .service-price-range .time {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .service-expand {
            font-size: 1.5rem;
            color: var(--text-light);
            transition: var(--transition);
        }

        .service-card.expanded .service-expand {
            transform: rotate(180deg);
        }

        .service-details {
            display: none;
            padding: 0 1.5rem 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .service-card.expanded .service-details {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }

            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .detail-section h4 {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-table {
            width: 100%;
            font-size: 0.9rem;
        }

        .detail-table td {
            padding: 0.5rem 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .detail-table td:last-child {
            text-align: right;
            font-weight: 600;
        }

        .upsell-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            color: var(--bg-dark);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .script-box {
            background: #f0fdf4;
            border-left: 4px solid var(--success);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-top: 1rem;
            font-style: italic;
            color: var(--text-dark);
        }

        /* ===== CATEGORY FILTERS ===== */
        .category-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .category-pill {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .category-pill:hover,
        .category-pill.active {
            background: var(--primary-light);
            border-color: var(--primary-light);
        }

        /* ===== STATS BANNER ===== */
        .stats-banner {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent);
        }

        .stat-card .label {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {

            .calculator-grid,
            .packages-grid {
                grid-template-columns: 1fr;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .stats-banner {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-container {
                padding: 1rem;
            }

            .stats-banner {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üíß</div>
                <div class="logo-text">ORION <span>Price Book</span> Pro</div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('calculator')">üßÆ Calculadora</button>
                <button class="nav-tab" onclick="showTab('packages')">üì¶ Paquetes</button>
                <button class="nav-tab" onclick="showTab('catalog')">üìã Cat√°logo</button>
                <button class="nav-tab" onclick="showTab('settings')">‚öôÔ∏è Config</button>
            </nav>
        </div>
    </header>

    <main class="main-container">
        <!-- STATS BANNER -->
        <div class="stats-banner">
            <div class="stat-card">
                <div class="number">$185</div>
                <div class="label">Rate/Hora Lead</div>
            </div>
            <div class="stat-card">
                <div class="number">45%</div>
                <div class="label">Margen Objetivo</div>
            </div>
            <div class="stat-card">
                <div class="number">30%</div>
                <div class="label">Markup Material</div>
            </div>
            <div class="stat-card">
                <div class="number">200+</div>
                <div class="label">Servicios</div>
            </div>
        </div>

        <!-- TAB: CALCULATOR -->
        <div id="tab-calculator" class="tab-content active">
            <div class="calculator-grid">
                <div class="calc-card">
                    <h2>üßÆ Calculadora de Precios</h2>

                    <div class="input-group">
                        <label>Tipo de Servicio</label>
                        <select id="serviceType" onchange="updateCalculator()">
                            <option value="standard">Servicio Est√°ndar</option>
                            <option value="emergency">Emergencia (+50%)</option>
                            <option value="afterhours">After Hours (+25%)</option>
                            <option value="weekend">Fin de Semana (+35%)</option>
                        </select>
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>Horas Lead Plumber</label>
                            <input type="number" id="hoursLead" value="2" min="0" step="0.5"
                                onchange="updateCalculator()">
                        </div>
                        <div class="input-group">
                            <label>Horas Ayudante</label>
                            <input type="number" id="hoursHelper" value="0" min="0" step="0.5"
                                onchange="updateCalculator()">
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Costo Materiales (Tu Costo)</label>
                        <input type="number" id="materialCost" value="100" min="0" step="10"
                            onchange="updateCalculator()">
                    </div>

                    <div class="input-row">
                        <div class="input-group">
                            <label>Margen Deseado (%)</label>
                            <input type="number" id="marginPercent" value="45" min="20" max="70"
                                onchange="updateCalculator()">
                        </div>
                        <div class="input-group">
                            <label>Contingencia (%)</label>
                            <input type="number" id="contingency" value="10" min="0" max="25"
                                onchange="updateCalculator()">
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Tier de Precio</label>
                        <select id="priceTier" onchange="updateCalculator()">
                            <option value="good">ü•â GOOD (Base)</option>
                            <option value="better" selected>ü•à BETTER (+25%)</option>
                            <option value="best">ü•á BEST (+50%)</option>
                        </select>
                    </div>
                </div>

                <div class="calc-card result-card">
                    <h2>üí∞ Resultado</h2>

                    <div class="result-item">
                        <span class="result-label">Mano de Obra Lead</span>
                        <span class="result-value" id="laborLeadCost">$370.00</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Mano de Obra Ayudante</span>
                        <span class="result-value" id="laborHelperCost">$0.00</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Materiales (+30% markup)</span>
                        <span class="result-value" id="materialTotal">$130.00</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Subtotal (Tu Costo)</span>
                        <span class="result-value" id="subtotal">$500.00</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Multiplicador Tier</span>
                        <span class="result-value" id="tierMultiplier">√ó1.25</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Contingencia</span>
                        <span class="result-value" id="contingencyAmount">+$90.63</span>
                    </div>

                    <div class="result-total">
                        <div class="label">PRECIO AL CLIENTE</div>
                        <div class="amount" id="finalPrice">$996.88</div>
                        <div class="margin-badge" id="marginBadge">‚úì 45% Margen = $448.59 ganancia</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: PACKAGES -->
        <div id="tab-packages" class="tab-content">
            <div class="packages-header">
                <h1>üì¶ Sistema de Paquetes</h1>
                <p>Presenta las 3 opciones. El 60% de clientes elige BETTER.</p>
            </div>

            <div class="service-selector">
                <label>Selecciona el Servicio:</label>
                <select id="packageService" onchange="updatePackages()">
                    <option value="wh40">Water Heater 40 Gal - Standard Install</option>
                    <option value="wh50">Water Heater 50 Gal - Standard Install</option>
                    <option value="tankless">Tankless Water Heater Install</option>
                    <option value="toilet">Toilet Replacement</option>
                    <option value="faucet">Kitchen Faucet Install</option>
                    <option value="disposal">Garbage Disposal Install</option>
                    <option value="mainline">Main Line Cleaning</option>
                    <option value="repipe">Whole House Repipe (Per Bath)</option>
                </select>
            </div>

            <div class="packages-grid" id="packagesGrid">
                <!-- Packages will be populated by JS -->
            </div>
        </div>

        <!-- TAB: CATALOG -->
        <div id="tab-catalog" class="tab-content">
            <div class="category-pills">
                <button class="category-pill active" onclick="filterCategory('all')">üìã Todos</button>
                <button class="category-pill" onclick="filterCategory('appliance')">üîå Appliances</button>
                <button class="category-pill" onclick="filterCategory('gas')">üî• Gas</button>
                <button class="category-pill" onclick="filterCategory('drain')">üöø Drenajes</button>
                <button class="category-pill" onclick="filterCategory('waterheater')">‚ô®Ô∏è Water Heaters</button>
                <button class="category-pill" onclick="filterCategory('faucet')">üö∞ Grifer√≠a</button>
                <button class="category-pill" onclick="filterCategory('filtration')">üíß Filtraci√≥n</button>
            </div>

            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="catalogSearch" placeholder="Buscar servicio, c√≥digo, o descripci√≥n..."
                        onkeyup="searchCatalog()">
                </div>
                <button class="filter-btn" onclick="sortCatalog('price')">üí∞ Por Precio</button>
                <button class="filter-btn" onclick="sortCatalog('time')">‚è±Ô∏è Por Tiempo</button>
                <button class="filter-btn" onclick="sortCatalog('margin')">üìà Por Margen</button>
            </div>

            <div class="services-grid" id="servicesGrid">
                <!-- Services will be populated by JS -->
            </div>
        </div>

        <!-- TAB: SETTINGS -->
        <div id="tab-settings" class="tab-content">
            <div class="calc-card" style="max-width: 600px;">
                <h2>‚öôÔ∏è Configuraci√≥n de Rates</h2>

                <div class="input-group">
                    <label>Rate Lead Plumber ($/hr)</label>
                    <input type="number" id="rateLead" value="185" onchange="saveSettings()">
                </div>

                <div class="input-group">
                    <label>Rate Ayudante ($/hr)</label>
                    <input type="number" id="rateHelper" value="95" onchange="saveSettings()">
                </div>

                <div class="input-group">
                    <label>Markup Materiales (%)</label>
                    <input type="number" id="markupMaterial" value="30" onchange="saveSettings()">
                </div>

                <div class="input-group">
                    <label>Margen Objetivo Default (%)</label>
                    <input type="number" id="defaultMargin" value="45" onchange="saveSettings()">
                </div>

                <div class="input-group">
                    <label>Regi√≥n</label>
                    <select id="region" onchange="saveSettings()">
                        <option value="bayarea" selected>Bay Area, CA</option>
                        <option value="la">Los Angeles, CA</option>
                        <option value="sacramento">Sacramento, CA</option>
                        <option value="other">Otra Regi√≥n</option>
                    </select>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ===== SETTINGS =====
        let settings = {
            rateLead: 185,
            rateHelper: 95,
            markupMaterial: 30,
            defaultMargin: 45
        };

        // ===== SERVICES DATABASE =====
        const servicesDB = [
            {
                id: 'AP-002',
                category: 'appliance',
                name: 'Dishwasher Complete Installation',
                description: 'Instalaci√≥n completa de lavavajillas provisto por cliente',
                time: 1.5,
                materials: 57,
                priceGood: 485,
                priceBetter: 585,
                priceBest: 725,
                tasks: [
                    { name: 'Posicionar unidad', time: '15 min' },
                    { name: 'Conectar suministro agua', time: '20 min' },
                    { name: 'Conectar drenaje', time: '20 min' },
                    { name: 'Conexi√≥n el√©ctrica', time: '10 min' },
                    { name: 'Test funcionamiento', time: '15 min' }
                ],
                upsells: [
                    { name: 'Braided SS Hoses', price: 85 },
                    { name: 'Air Gap Chrome', price: 125 }
                ],
                script: 'Estas mangueras de acero inoxidable duran 10+ a√±os y previenen inundaciones.'
            },
            {
                id: 'GS-007',
                category: 'gas',
                name: 'Gas Dryer Connection',
                description: 'Conexi√≥n de secadora de gas con flex SS 48"',
                time: 0.75,
                materials: 47,
                priceGood: 350,
                priceBetter: 425,
                priceBest: 550,
                tasks: [
                    { name: 'Verificar shut-off valve', time: '5 min' },
                    { name: 'Instalar gas flex', time: '25 min' },
                    { name: 'Prueba de fugas', time: '10 min' },
                    { name: 'Verificar ignici√≥n', time: '5 min' }
                ],
                upsells: [
                    { name: 'Seismic Valve', price: 450 },
                    { name: 'Sediment Trap', price: 185 }
                ],
                script: 'Obligatorio en California para nuevas instalaciones - protege de fugas por terremoto.'
            },
            {
                id: 'DR-090',
                category: 'drain',
                name: 'Main Line Cleaning (Through Clean Out)',
                description: 'Limpieza de l√≠nea principal 3-4" con cable machine',
                time: 1.75,
                materials: 0,
                priceGood: 385,
                priceBetter: 485,
                priceBest: 650,
                tasks: [
                    { name: 'Locate clean out', time: '5 min' },
                    { name: 'Setup machine', time: '10 min' },
                    { name: 'Cable main line', time: '60 min' },
                    { name: 'Test flow', time: '10 min' },
                    { name: 'Cleanup', time: '15 min' }
                ],
                upsells: [
                    { name: 'Camera Inspection', price: 250 },
                    { name: 'Install Cleanout', price: 800 }
                ],
                script: 'Podemos ver exactamente qu√© hay en sus tuber√≠as y prevenir problemas futuros.'
            },
            {
                id: 'WH-350',
                category: 'waterheater',
                name: 'Water Heater 40 Gal Install',
                description: 'Instalaci√≥n completa de calentador 40 galones con code upgrades',
                time: 3.5,
                materials: 850,
                priceGood: 2400,
                priceBetter: 2950,
                priceBest: 3800,
                tasks: [
                    { name: 'Drain & remove old unit', time: '45 min' },
                    { name: 'Position new heater', time: '30 min' },
                    { name: 'Connect water lines', time: '45 min' },
                    { name: 'Connect gas line', time: '30 min' },
                    { name: 'Install T&P valve', time: '15 min' },
                    { name: 'Install seismic straps', time: '20 min' },
                    { name: 'Light pilot & test', time: '25 min' }
                ],
                upsells: [
                    { name: 'Expansion Tank', price: 350 },
                    { name: 'Recirculation Pump', price: 650 },
                    { name: 'PRV Replace', price: 450 }
                ],
                script: 'El tanque de expansi√≥n es obligatorio por c√≥digo y protege su calentador de da√±os por presi√≥n.'
            },
            {
                id: 'FC-123',
                category: 'faucet',
                name: 'Kitchen Faucet Installation',
                description: 'Instalaci√≥n de grifo de cocina est√°ndar',
                time: 1.0,
                materials: 20,
                priceGood: 350,
                priceBetter: 425,
                priceBest: 550,
                tasks: [
                    { name: 'Disconnect old faucet', time: '15 min' },
                    { name: 'Remove & clean', time: '10 min' },
                    { name: 'Install new faucet', time: '25 min' },
                    { name: 'Connect supplies', time: '10 min' }
                ],
                upsells: [
                    { name: 'Braided SS Supplies', price: 45 },
                    { name: 'Angle Stops Upgrade', price: 95 }
                ],
                script: 'Las l√≠neas de acero inoxidable previenen fugas y duran toda la vida del grifo.'
            },
            {
                id: 'WF-144',
                category: 'filtration',
                name: 'Water Softener Install (1-3 Bath)',
                description: 'Sistema suavizador de agua WS 1054',
                time: 3.5,
                materials: 790,
                priceGood: 2800,
                priceBetter: 3200,
                priceBest: 3800,
                tasks: [
                    { name: 'Site prep, locate loop', time: '30 min' },
                    { name: 'Install softener tanks', time: '60 min' },
                    { name: 'Connect water lines', time: '45 min' },
                    { name: 'Install drain line', time: '30 min' },
                    { name: 'Program controller', time: '15 min' }
                ],
                upsells: [
                    { name: 'RO System Add-on', price: 650 },
                    { name: 'Sediment Pre-filter', price: 185 }
                ],
                script: 'Un sistema RO bajo el fregadero le dar√° agua de calidad premium para beber.'
            }
        ];

        // ===== PACKAGES DATA =====
        const packagesData = {
            wh40: {
                name: 'Water Heater 40 Gal',
                good: {
                    price: 2400,
                    features: [
                        'Bradford White Standard 40 Gal',
                        'Instalaci√≥n b√°sica',
                        'Conexiones est√°ndar',
                        'Garant√≠a 6 a√±os tanque',
                        'Garant√≠a 30 d√≠as labor'
                    ]
                },
                better: {
                    price: 2950,
                    features: [
                        'Bradford White Standard 40 Gal',
                        'Expansion Tank incluido',
                        'Drain Pan + Drain Line',
                        'Seismic Straps Premium',
                        'Garant√≠a 6 a√±os tanque',
                        'Garant√≠a 1 a√±o labor'
                    ]
                },
                best: {
                    price: 3800,
                    features: [
                        'Rheem Professional Grade 40 Gal',
                        'ALL Code Upgrades incluidos',
                        'Expansion Tank',
                        'Recirculation Pump',
                        'PRV Check/Replace',
                        'Garant√≠a 10 a√±os tanque',
                        'Garant√≠a 2 a√±os labor'
                    ]
                }
            },
            tankless: {
                name: 'Tankless Water Heater',
                good: {
                    price: 4200,
                    features: [
                        'Rinnai/Navien Standard',
                        'Gas line extension b√°sica',
                        'Venting est√°ndar',
                        'Garant√≠a fabricante'
                    ]
                },
                better: {
                    price: 5500,
                    features: [
                        'Rinnai/Navien Premium',
                        'Recirculation built-in',
                        'Scale flush kit',
                        'WiFi control',
                        'Garant√≠a 1 a√±o labor'
                    ]
                },
                best: {
                    price: 7200,
                    features: [
                        'Navien NPE-240A Premium',
                        'Dual recirculation',
                        'Whole house integration',
                        'Smart home compatible',
                        'Scale prevention system',
                        'Garant√≠a 2 a√±os labor'
                    ]
                }
            },
            toilet: {
                name: 'Toilet Replacement',
                good: {
                    price: 485,
                    features: [
                        'Standard toilet (client provides)',
                        'Wax ring new',
                        'Flange inspection',
                        'Basic install'
                    ]
                },
                better: {
                    price: 650,
                    features: [
                        'Premium wax-free seal',
                        'New supply line SS',
                        'New angle stop',
                        'Flange repair if needed',
                        '1 year labor warranty'
                    ]
                },
                best: {
                    price: 850,
                    features: [
                        'Toto/Kohler style bolt caps',
                        'All new hardware',
                        'Caulk professional finish',
                        'Slow-close seat included',
                        'Extended warranty'
                    ]
                }
            }
        };

        // ===== TAB NAVIGATION =====
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');

            // Highlight nav button
            event.target.classList.add('active');

            // Initialize content if needed
            if (tabName === 'packages') updatePackages();
            if (tabName === 'catalog') renderCatalog();
        }

        // ===== CALCULATOR =====
        function updateCalculator() {
            const serviceType = document.getElementById('serviceType').value;
            const hoursLead = parseFloat(document.getElementById('hoursLead').value) || 0;
            const hoursHelper = parseFloat(document.getElementById('hoursHelper').value) || 0;
            const materialCost = parseFloat(document.getElementById('materialCost').value) || 0;
            const marginPercent = parseFloat(document.getElementById('marginPercent').value) || 45;
            const contingency = parseFloat(document.getElementById('contingency').value) || 10;
            const priceTier = document.getElementById('priceTier').value;

            // Service type multipliers
            const typeMultipliers = {
                standard: 1.0,
                emergency: 1.5,
                afterhours: 1.25,
                weekend: 1.35
            };

            // Tier multipliers
            const tierMultipliers = {
                good: 1.0,
                better: 1.25,
                best: 1.50
            };

            const typeMultiplier = typeMultipliers[serviceType];
            const tierMultiplier = tierMultipliers[priceTier];

            // Calculations
            const laborLeadCost = hoursLead * settings.rateLead * typeMultiplier;
            const laborHelperCost = hoursHelper * settings.rateHelper * typeMultiplier;
            const materialTotal = materialCost * (1 + settings.markupMaterial / 100);
            const subtotal = laborLeadCost + laborHelperCost + materialTotal;

            // Apply margin formula: Price = Cost / (1 - margin%)
            const basePrice = subtotal / (1 - marginPercent / 100);
            const tieredPrice = basePrice * tierMultiplier;
            const contingencyAmount = tieredPrice * (contingency / 100);
            const finalPrice = tieredPrice + contingencyAmount;

            // Calculate actual profit
            const profit = finalPrice - subtotal;
            const actualMargin = (profit / finalPrice) * 100;

            // Update UI
            document.getElementById('laborLeadCost').textContent = '$' + laborLeadCost.toFixed(2);
            document.getElementById('laborHelperCost').textContent = '$' + laborHelperCost.toFixed(2);
            document.getElementById('materialTotal').textContent = '$' + materialTotal.toFixed(2);
            document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('tierMultiplier').textContent = '√ó' + tierMultiplier.toFixed(2);
            document.getElementById('contingencyAmount').textContent = '+$' + contingencyAmount.toFixed(2);
            document.getElementById('finalPrice').textContent = '$' + finalPrice.toFixed(2);
            document.getElementById('marginBadge').textContent = '‚úì ' + actualMargin.toFixed(0) + '% Margen = $' + profit.toFixed(2) + ' ganancia';
        }

        // ===== PACKAGES =====
        function updatePackages() {
            const serviceId = document.getElementById('packageService').value;
            const data = packagesData[serviceId] || packagesData.wh40;

            const grid = document.getElementById('packagesGrid');
            grid.innerHTML = `
                <div class="package-card">
                    <div class="package-header">
                        <div class="package-tier">ü•â</div>
                        <div class="package-name">GOOD</div>
                        <div class="package-price">$${data.good.price.toLocaleString()}</div>
                    </div>
                    <div class="package-features">
                        ${data.good.features.map(f => `
                            <div class="feature-item">
                                <span class="feature-check">‚úì</span>
                                <span>${f}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="package-cta">
                        <button class="package-btn">Seleccionar GOOD</button>
                    </div>
                </div>
                
                <div class="package-card recommended">
                    <div class="package-header">
                        <div class="package-tier">ü•à</div>
                        <div class="package-name">BETTER</div>
                        <div class="package-price">$${data.better.price.toLocaleString()}</div>
                    </div>
                    <div class="package-features">
                        ${data.better.features.map(f => `
                            <div class="feature-item">
                                <span class="feature-check">‚úì</span>
                                <span>${f}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="package-cta">
                        <button class="package-btn">Seleccionar BETTER</button>
                    </div>
                </div>
                
                <div class="package-card">
                    <div class="package-header">
                        <div class="package-tier">ü•á</div>
                        <div class="package-name">BEST</div>
                        <div class="package-price">$${data.best.price.toLocaleString()}</div>
                    </div>
                    <div class="package-features">
                        ${data.best.features.map(f => `
                            <div class="feature-item">
                                <span class="feature-check">‚úì</span>
                                <span>${f}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="package-cta">
                        <button class="package-btn">Seleccionar BEST</button>
                    </div>
                </div>
            `;
        }

        // ===== CATALOG =====
        let currentCategory = 'all';

        function renderCatalog() {
            const grid = document.getElementById('servicesGrid');
            let services = servicesDB;

            if (currentCategory !== 'all') {
                services = services.filter(s => s.category === currentCategory);
            }

            grid.innerHTML = services.map(service => `
                <div class="service-card" id="service-${service.id}">
                    <div class="service-header" onclick="toggleService('${service.id}')">
                        <div class="service-info">
                            <h3>${service.name}</h3>
                            <span class="code">${service.id} | ${service.description}</span>
                        </div>
                        <div class="service-price-range">
                            <div class="price">$${service.priceGood} - $${service.priceBest}</div>
                            <div class="time">‚è±Ô∏è ${service.time} hrs</div>
                        </div>
                        <span class="service-expand">‚ñº</span>
                    </div>
                    <div class="service-details">
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>üìã Actividades Detalladas</h4>
                                <table class="detail-table">
                                    ${service.tasks.map(t => `
                                        <tr>
                                            <td>${t.name}</td>
                                            <td>${t.time}</td>
                                        </tr>
                                    `).join('')}
                                </table>
                            </div>
                            <div class="detail-section">
                                <h4>üí∞ Pricing Tiers</h4>
                                <table class="detail-table">
                                    <tr><td>ü•â GOOD</td><td>$${service.priceGood}</td></tr>
                                    <tr><td>ü•à BETTER</td><td>$${service.priceBetter}</td></tr>
                                    <tr><td>ü•á BEST</td><td>$${service.priceBest}</td></tr>
                                </table>
                                
                                <h4 style="margin-top:1rem;">üìà Upsells</h4>
                                ${service.upsells.map(u => `
                                    <div class="upsell-badge">+$${u.price} ${u.name}</div>
                                `).join(' ')}
                            </div>
                        </div>
                        <div class="script-box">
                            <strong>üí¨ Script de Venta:</strong> "${service.script}"
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleService(id) {
            const card = document.getElementById('service-' + id);
            card.classList.toggle('expanded');
        }

        function filterCategory(category) {
            currentCategory = category;

            document.querySelectorAll('.category-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            event.target.classList.add('active');

            renderCatalog();
        }

        function searchCatalog() {
            const query = document.getElementById('catalogSearch').value.toLowerCase();
            const cards = document.querySelectorAll('.service-card');

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? 'block' : 'none';
            });
        }

        // ===== SETTINGS =====
        function saveSettings() {
            settings.rateLead = parseFloat(document.getElementById('rateLead').value) || 185;
            settings.rateHelper = parseFloat(document.getElementById('rateHelper').value) || 95;
            settings.markupMaterial = parseFloat(document.getElementById('markupMaterial').value) || 30;
            settings.defaultMargin = parseFloat(document.getElementById('defaultMargin').value) || 45;

            updateCalculator();
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', function () {
            updateCalculator();
            updatePackages();
            renderCatalog();
        });
    </script>
</body>

</html>